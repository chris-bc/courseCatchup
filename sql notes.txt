select date,count(*) as p from missed group by date order by p desc

-- what sessions have people who will be at saturday missed in decreasing order (and their names)
select m.date,p.firstname from missed m,person p,available a, day d where p.id=m.person_id and p.id=a.person_id and d.id=a.day_id and d.name='Sunday'

select m.date,count(p.firstname) pax from missed m,person p,available a, day d where p.id=m.person_id and p.id=a.person_id and d.id=a.day_id and d.name='Sunday' group by date order by pax desc;


-- descending order of
   -- days by number of available people by sessions missed
select d.name,p.firstname,count(a.person_id),m.date from 
 day d, available a,person p,missed m where d.name='Friday' and d.id=a.day_id and p.id=a.person_id and p.id=m.person_id and d.name not in('Saturday','Sunday') group by d.name order by d.id;
 
 
-- 2 nested group bys to make it work - first to get availability then to get sessions missed
select m.date,p.firstname,d.name,count(m.person_id) pax from day d, available a,person p,missed m where d.id=a.day_id and p.id=a.person_id and p.id=m.person_id and d.name not in('Saturday','Sunday') group by d.name order by pax desc;
 
 


-- Days by sessions missed by available people
 select d.name,m.date,count(distinct m.person_id) pax from person p,missed m,available a,day d where p.id=m.person_id and p.id=a.person_id and a.day_id=d.id group by d.name,m.date order by d.id, pax desc;

-- Days by available people by sessions missed
 select d.name, p.firstname, count(distinct m.date) ses from person p,missed m,available a,day d where p.id=m.person_id and p.id=a.person_id and a.day_id=d.id group by d.name,a.person_id order by d.id, ses desc;
 
 select d.name,m.date,p.firstname from person p,missed m, day d, available a where p.id=m.person_id and a.person_id=p.id and a.day_id=d.id order by m.sort_id
 
 -- Final product for weekend scheduling
 select d.name,m.date,count(p.firstname) avail from person p,missed m, day d, available a where p.id=m.person_id and a.person_id=p.id and a.day_id=d.id and m.complete is null and d.name in('Saturday','Sunday') group by d.name,m.date order by d.id, avail desc
 
 -- Final - days in decreasing order of people's need and availability, and total number of missed sessions for those ppl (not considering whether sessions are in common)
 select d.name, count(z.firstname) num_ppl, sum(z.miss) num_sess from day d,
(select d.name,p.firstname,count(m.date) miss from person p,missed m,available a,day d where p.id=m.person_id and p.id=a.person_id and a.day_id=d.id group by d.name,p.firstname) z
where d.name=z.name group by d.name order by num_ppl desc, num_sess desc

-- From here - days in decreasing order of availability and # sessions which at least 50% of ppl missed
select d.name, count(z.firstname) num_ppl, sum(z.miss) num_sess from day d,
(select d.name,p.firstname,count(m.date) miss from person p,missed m,available a,day d where p.id=m.person_id and p.id=a.person_id and a.day_id=d.id group by d.name,p.firstname) z
where d.name=z.name group by d.name order by num_ppl desc, num_sess desc

select d.name,p.firstname,count(m.date) miss from person p,missed m,available a,day d where p.id=m.person_id and p.id=a.person_id and a.day_id=d.id group by d.name,p.firstname
-- want session day, catch up day, num ppl avail on that day
select z.date, z.name, max(num_ppl) num_ppl from
(select m.date,d.name,count(a.person_id) num_ppl from missed m,day d,available a where m.person_id=a.person_id and a.day_id=d.id group by m.date,d.name) z,
missed m, day d where z.date=m.date and z.name=d.name
group by z.date,z.name order by d.id,num_ppl desc

-- And a grand total of num_ppl per night (although isn't that what I did above? :/)
select x.name,count(x.date) sessions,sum(num_ppl) people from(
select z.date, z.name, max(num_ppl) num_ppl from
(select m.date,d.name,count(a.person_id) num_ppl from missed m,day d,available a where m.complete is null and m.person_id=a.person_id and a.day_id=d.id group by m.date,d.name) z,
missed m, day d where z.date=m.date and z.name=d.name
group by z.date,z.name) x, day d where x.name=d.name
group by x.name order by people desc,sessions desc;

, missed m, day d where x.name=d.name and m.sort_id=(select min(sort_id) from missed m2 where m2.date=x.date)
group by x.name 
-- sat, sess 35, ppl 115?
-- x has date, day name
 x, missed m, day d where x.date=m.date and x.name=d.name
 order by d.id,num_ppl desc
 
 update missed set complete=1 where person_id in(select person_id from available a,day d where a.day_id=d.id and d.name='Saturday') and date in('16/9','2/9','26/8','19/8')
 
 - Who is available Saturday & missed 16/9
 select * from available a, missed m, day d, person p WHERE a.person_id=p.id and a.day_id=d.id and a.person_id=m.person_id
 - Who is available available Saturday xor Sunday

   - Differences between Saturday availability and Sunday availability?
 
 - Impact of completing the weekend